DESCRIPTION
===========

This cookbook installs sudo and configures the /etc/sudoers file.

REQUIREMENTS
============

Requires that the platform has a package named sudo and the sudoers file is /etc/sudoers.

ATTRIBUTES
==========

The following attributes are set to blank arrays:

    node['authorization']['sudo']['groups']
    node['authorization']['sudo']['users']

They are passed into the sudoers template which iterates over the values to add sudo permission to the specified users and groups.

If you prefer to use passwordless sudo just set the following attribute to true:

    node['authorization']['sudo']['passwordless']

This attribute controls whether or not to include the /etc/sudoers.d
directory, it default to false. If you set it to true, the default
recipe will create the directory /etc/sudoers.d and put the
placeholder file README there

 node['authorization']['sudo']['include_sudoers_d']

USAGE
=====

To use this cookbook, set the attributes above on the node via a role or the node object itself. In a role.rb:

    "authorization" => {
      "sudo" => {
        "groups" => ["admin", "wheel", "sysadmin"],
        "users" => ["jerry", "greg"],
        "passwordless" => true
      }
    }

In JSON (role.json or on the node object):

    "authorization": {
      "sudo": {
        "groups": [
          "admin",
          "wheel",
          "sysadmin"
        ],
        "users": [
          "jerry",
          "greg"
        ],
        "passwordless": true
      }
    }

Note that the template for the sudoers file has the group "sysadmin" with ALL:ALL permission, though the group by default does not exist.

sudo LWRP
=============

This is a fairly complex LWRP for managing sudoers fragment files in
/etc/sudoers.d. It has many different options. Regardless
of which options you use, this lwrp will 1) make sure the permissions
on any sudoers fragment file are correct 2) fail the chef-client run
before trying to place an invalid fragment file in /etc/sudoers.d/ .
#2 ensures that your existing sudoers configuration will not be corrupted.


This LWRP operates in two modes, "template" and "pattern"

The simplest mode is template mode

    sudo "nagios"
      template "nagios_sudoers.erb"
      variables( :cmds => [ "check_init_service",  "check_hpasm" ] )
    end

This generates the file /etc/sudoers.d/nagios

    # this file was generated by chef
    nagios ALL=NOPASSWD: /usr/local/nagios/plugins/check_init_service
    nagios ALL=NOPASSWD: /usr/local/nagios/plugins/check_hpasm


This mode essentially wraps around a the template resource to ensure
the resulting configuration is valid.

The template attribute sources the "nagios_sudoers.erb" file from the
calling cookbook, not the sudo cookbook. The variables attribute works
just like the variables attribute of the template resource.

Pattern mode is more complex. The purpose of pattern mode is to
abstract common "patterns" of sudo use so that the calling cookbook
doesn't have to supply them at all, the current patterns are:

* super - full sudo access, essentially root access
* app - The members of an application group can act as the same user
that the application runs under and manage the application using the
service command
* act_as_all - user/group can execute the supplied commands as any user

These patterns use templates in this cookbook, templates/default/#{pattern}

Example using a pattern

    sudo "tomcat" do
      user "tomcat"
      pattern "app"
    end

This generates the following 

     # This file is generated by Chef, all manual changes will be overriden
     %geo     ALL=(geo) NOPASSWD:ALL
     %geo     ALL=(root)  NOPASSWD: /sbin/service geo [a-zA-Z]*


Description of all attributes

* :user -- user to provide sudo privileges to
* :group -- group to provide sudo privileges to
* :service -- specific to the "app" pattern, used when the service to
be manipulated has an different name than the user it runs as
* :cmds -- an array of commands that the user/group can execute using
sudo, must use the full path
* :passwordless -- whether or not a password must be supplied when
invoking sudo
* :pattern -- use a template built into the sudo cookbook, the default
is "act_as_all"
* :template -- a template file in the current cookbook (not the sudo
cookbook), currently must be an erb template
* :variables -- variables to use with the template


TODO
====

* Allow user and group to accept an array 


LICENSE AND AUTHOR
==================

Author:: Bryan W. Berry <bryan.berry@gmail.com>
Author:: Adam Jacob <adam@opscode.com>
Author:: Seth Chisamore <schisamo@opscode.com>

Copyright 2009-2011, Opscode, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
